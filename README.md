# Heart Disease Prediction API
## 1. Описание задачи
git push -f или работа в production
Домашнее задание по созданию fastapi-приложения для модели классификации, развернутого при помощи Docker.

Цель:
В этом домашнем задании, вам нужно создать fastapi-приложение для вашей модели классификации и развернуть данное приложение при помощи Docker. Протестировать get запросы (направляя X-вектор переменных) и получить response в виде целевой переменной, для теста можно использовать Python/Postman.
Датасет https://www.kaggle.com/datasets/johnsmith88/heart-disease-dataset/

## 2. Описание проекта
Проект представляет собой ML-сервис для классификации сердечно-сосудистых заболеваний
Сервис позволяет:
* получать предсказания для одного пациента;
* скорить таблицы данных (JSON / CSV);
* переобучать модель внутри контейнера;
* работать через REST API и Web-интерфейс (UI).

В результате пользователь может получить predictions по загруженным им данным в интерфейс в различных допустимых форматах.

## 3. Используемая модель
* Алгоритм: `RandomForestClassifier`
* Библиотека: `scikit-learn`
* Задача: бинарная классификация (`0` — нет болезни, `1` — есть болезнь)


## 4. Как запустить проект

### 4.1 Клонировать репозиторий
```bash
git clone https://github.com/Yaroslav95/production/
cd production
```
### 4.2 Установить зависимости
```bash
pip install -r requirements.txt
```
### 4.3 Запустить обучение модели (если есть необходимость и новые данные)
Данные разместить в папку data
```bash
python train_model.py
```

### 4.4 Собрать Docker-образ
```bash
docker build -t heart-api .
```

### 4.5 Запустить контейнер
```bash
docker run -p 8000:8000 heart-api
```
После запуска приложение будет доступно по адресу:

```
http://localhost:8000
```


## 5. FastAPI

FastAPI автоматически генерирует документацию:

```
http://localhost:8000/docs
```

Через этот адрес можно:
* отправлять запросы на `/predict`
* загружать CSV файлы
* запускать обучение модели

## 6. Как получить predict
### 6.1 Предсказание для одного объекта

```
POST /predict
```

Пример JSON:

```json
{
  "age": 63,
  "sex": 1,
  "cp": 3,
  "trestbps": 145,
  "chol": 233,
  "fbs": 1,
  "restecg": 0,
  "thalach": 150,
  "exang": 0,
  "oldpeak": 2.3,
  "slope": 0,
  "ca": 0,
  "thal": 1
}
```
Ответ:

```json
{ "prediction": 1 }
```
### Также через python скрипт
import requests

url = "http://localhost:8000/predict"

data = {
    "age": 63,
    "sex": 1,
    "cp": 3,
    "trestbps": 145,
    "chol": 233,
    "fbs": 1,
    "restecg": 0,
    "thalach": 150,
    "exang": 0,
    "oldpeak": 2.3,
    "slope": 0,
    "ca": 0,
    "thal": 1
}

response = requests.post(url, json=data)
print(response.json())  # {"prediction": 1}



### 6.2 Batch-предсказание (JSON таблица)

```
POST /predict_batch
```

Принимает массив объектов, возвращает массив предсказаний.

---

### 6.3 Предсказание по CSV файлу

```
POST /predict_file
```

* CSV должен содержать те же колонки, что и при обучении
* Лишние колонки автоматически игнорируются

Ответ:

```json
{
  "predictions": [1, 0, 1, 0]
}
```

## 7. Обучение модели внутри контейнера

```
POST /train
```

* Использует CSV файл `data/heart.csv`
* Переобучает модель
* Обновляет модель в памяти без перезапуска контейнера

Ответ:

```json
{ "status": "Модель успешно обучена" }
```
